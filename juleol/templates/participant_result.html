{% extends 'base.html' %}

{% block title %}Juleølsmaking result {{ participant.tasting.year }} for {{ participant.name }}{% endblock %}

{%block content %}
<h1>Juleølsmaking result {{ participant.tasting.year }} for {{ participant.name }}</h1>
{% if participant.tasting.heats %}
<p>
<label for="heat">Heat</label>
<select id="heatselect" name="heat" onchange="filter_heat();">
  <option value="All" {% if not heat %}selected="selected"{% endif %}>All</option>
  {% for h in participant.tasting.heats %}
  <option value="{{ h.id }}" {% if heat and heat == h.id %}selected="selected"{% endif %}>{{ h.name }}</option>
  {% endfor %}
</select>
</p>
{% endif %}
<table id="resulttable">
  <thead>
    <tr>
      <th style="width: 7em;">Number</th>
      <th style="width: 7em;">Beer number</th>
      <th>Beer</th>
      <th style="width: 5em;">Look</th>
      <th style="width: 5em;">Smell</th>
      <th style="width: 5em;">Taste</th>
      <th style="width: 5em;">Aftertaste</th>
      <th style="width: 5em;">Xmas</th>
      <th style="width: 5em;">Sum</th>
      {%- if participant.tasting.heats %}
      <th>Heat</th>
      {%- endif %}
    </tr>
  </thead>
  <tbody>
    {% for score in scores %}
    <tr>
      <td class="row_index">{{ loop.index }}</td>
      {% if heat %}
      <td>{{ loop.index }} ({{ score.number }})</td>
      {% else %}
      <td>{{ score.number }}</td>
      {% endif %}
      <td>{{ score.name }}</td>
      <td>{{ score.look }}</td>
      <td>{{ score.smell }}</td>
      <td>{{ score.taste }}</td>
      <td>{{ score.aftertaste }}</td>
      <td>{{ score.xmas }}</td>
      <td>{{ (score.look or 0) + (score.smell or 0) + (score.taste or 0) + (score.aftertaste or 0) + (score.xmas or 0) }}</td>
      {%- if participant.tasting.heats %}
      <td>{{ score.heat_name }}</td>
      {%- endif %}
    </tr>
    {% endfor %}
  </tbody>
</table>
<p><a href="/result/{{ participant.tasting.year }}">Results {{ participant.tasting.year }}</a></p>
<p><a href="/">Home</a></p>

<script>
function filter_heat() {
  url = new URL(window.location);
  heat = $("#heatselect")[0].value;
  if(heat == "All") {
    url.search = "";
  } else {
    url.search = "heat=" + heat;
  };
  window.location = url;
};

$(document).ready(function() {
  $('#resulttable').tablesorter({
  });
  $('#resulttable').bind("sortEnd", function() {
    var i = 1;
    $("td.row_index").each(function() {
      $(this).text(i);
      i = i + 1;
    });
  });
})
</script>
{% endblock %}
